<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>getset</title>
</head>

<body>
    <div id="test">
        <p>{{msg}}</p>
    </div>
    <script>
        var mark = 'data-binding'

        function jvue(id, initData) {
            var self = this,
                data = self.data = {},
                el = document.getElementById(id),
                bindingDatas = {},
                content = el.innerHTML.replace(/\{\{(.*)\}\}/g, markReplace);

            el.innerHTML = content;

            for (var val in bindingDatas) {
                bind(val);
            }

            console.log(bindingDatas);

            if (initData) {
                for (var val in initData) {
                    if (initData.hasOwnProperty(val)) {
                        data[val] = initData[val];
                    }
                }
            }

            function markReplace(match, val) {
                bindingDatas[val] = {};
                return '<span ' + mark + '="' + val + '"></span>';
            }

            function bind(val) {
                bindingDatas[val].els = document.querySelectorAll('[' + mark + '="' + val + '"]');
                [].forEach.call(bindingDatas[val].els, function(e) {
                    e.removeAttribute(mark);
                });
                Object.defineProperty(data, val, {
                    set: function(newVal) {
                        [].forEach.call(bindingDatas[val].els, function(e) {
                            bindingDatas[val].value = e.textContent = newVal;
                        })
                    },
                    get: function() {
                        return bindingDatas[val].value;
                    }
                })
            }
        }

        var app = new jvue('test', {
            msg: 'hello'
        })
    </script>
</body>

</html>
